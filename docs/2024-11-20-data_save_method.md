# データの保存の仕方

ETF や投資信託の期待値と標準偏差を計算してポートフォリオを評価する

最終的に欲しいデータは各銘柄の期待値と標準偏差

## データフローの概要

### 1. データ収集

金融データの API を使用して ETF や投資信託の価格データを取得．

取得したデータを直接データベースに保存．

(一度 CSV で保存してからデータベースに保存する方法もあるが，外部のデータであり，バックアップの必要がないため，使う必要がないと考えた．)

```plant
価格履歴テーブル (PriceHistory)
  * 履歴 ID (HistoryID)
  --
  * 投資 ID (InvestmentID)
  * 株価 (Price)
  * 日付 (Date)
```

| HistoryID | InvestmentID | Price | Date       |
| --------- | ------------ | ----- | ---------- |
| 1         | 1            | 100   | 2021-01-01 |
| 2         | 1            | 101   | 2021-01-02 |
| 3         | 2            | 200   | 2021-01-01 |
| 4         | 2            | 201   | 2021-01-02 |
| 5         | 3            | 300   | 2021-01-01 |
| 6         | 3            | 301   | 2021-01-02 |

#### HW

- AWS Lambda: 定期的にデータを取得するためのサーバレスコンピューティングサービス
- Amazon RDS: フルマネージドの RDB サービス．インフラ管理が楽になる．
- Amazon S3: オブジェクトストレージ(CSV を挟む場合に使用)

#### SW

- Python
- Pandas: データ操作ライブラリ
- yfinance: Yahoo Finance API を使用するためのライブラリ
- PostgreSQL: データベースエンジン
- SQLAlchemy: Python から PostgreSQL にアクセスするためのライブラリ

### 2. データ処理

取得したデータから各銘柄の期待値と標準偏差を計算．

```plant
ETF/投資信託テーブル (Investment)
  * 投資 ID (InvestmentID)
  --
  * 銘柄名 (Ticker)
  * 期待値 (ExpectedValue)
  * 標準偏差 (StandardDeviation)
```

| InvestmentID | Ticker | ExpectedValue | StandardDeviation |
| ------------ | ------ | ------------- | ----------------- |
| 1            | AAA    | 0.08          | 0.15              |
| 2            | BBB    | 0.07          | 0.14              |
| 3            | CCC    | 0.09          | 0.16              |

#### HW

- AWS Lambda: 定期的に計算するためのサーバレスコンピューティングサービス
- Amazon RDS: フルマネージドの RDB サービス．インフラ管理が楽になる．
- Amazon EC2: データ処理を行うための仮想サーバー

#### SW

- Python
- Pandas: データ操作ライブラリ
- Numpy: 数値計算ライブラリ
- SQLAlchemy: Python から PostgreSQL にアクセスするためのライブラリ

### 3. データ分析と表示

各銘柄の期待値と標準偏差，重みからポートフォリオの期待値と標準偏差を計算．

重みはブラウザ上で指定する．

ポートフォリオの期待値と標準偏差を表示．

#### HW

- Amazon RDS: フルマネージドの RDB サービス．インフラ管理が楽になる．
- Amazon EC2: データ分析を行うための仮想サーバー

#### SW

- Python
- Pandas: データ操作ライブラリ
- Numpy: 数値計算ライブラリ
- SQLAlchemy: Python から PostgreSQL にアクセスするためのライブラリ
- Streamlit: 分析結果をブラウザに表示するためのライブラリ

## 用語

### ストレージシステム

#### オブジェクトストレージ

ファイルにキーやタグを付加することでデータを管理するストレージ．

クラウド化に伴い，階層型よりも広く採用されるようになっているらしい．

Amazon S3 が有名．

#### 階層型ストレージ

データを異なるストレージ階層に分けて管理する．

データのアクセス頻度や重要度に応じて適切なストレージ階層にデータを配置する．SSD や HDD を使い分けるということか．

企業内やデータセンターで使うらしい．

### データベースシステム

| 特徴             | RDB      | NoSQL    |
| ---------------- | -------- | -------- |
| データモデル     | テーブル | 様々※1   |
| スキーマ         | 固定     | 柔軟     |
| クエリ言語       | SQL      | 物による |
| トランザクション | ACID     | 物による |

※1: キーバリューストア(キーと値のペアで保存)，ドキュメントストア(JSON 形式)，列指向など

## データモデル

### 概念データモデル (ER 図)

```plant
ETF/投資信託テーブル (Investment)
  * 投資 ID (InvestmentID)
  --
  * 銘柄名 (Ticker)
  * 期待値 (ExpectedValue)
  * 標準偏差 (StandardDeviation)
```

| InvestmentID | Ticker | ExpectedValue | StandardDeviation |
| ------------ | ------ | ------------- | ----------------- |
| 1            | AAA    | 0.08          | 0.15              |
| 2            | BBB    | 0.07          | 0.14              |
| 3            | CCC    | 0.09          | 0.16              |

```plant
価格履歴テーブル (PriceHistory)
  * 履歴 ID (HistoryID)
  --
  * 投資 ID (InvestmentID)
  * 株価 (Price)
  * 日付 (Date)
```

| HistoryID | InvestmentID | Price | Date       |
| --------- | ------------ | ----- | ---------- |
| 1         | 1            | 100   | 2021-01-01 |
| 2         | 1            | 101   | 2021-01-02 |
| 3         | 2            | 200   | 2021-01-01 |
| 4         | 2            | 201   | 2021-01-02 |
| 5         | 3            | 300   | 2021-01-01 |
| 6         | 3            | 301   | 2021-01-02 |

```plant
リレーションシップ:
  - ETF/投資信託は複数の価格履歴を持つ
```

### 論理データモデル

```sql

これから勉強する

```
